<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>¿Quién quiere ser millonario? - Scrum & Green Project Management</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
      background-image: url('https://th.bing.com/th/id/OIP.DEWCr0LfSJsX5c6W0XVtcQHaE8?rs=1&pid=ImgDetMain');
      background-size: cover;
      background-position: center;
      color: white;
    }
    #game-container {
      width: 90%;
      max-width: 650px;
      background-color: rgba(0, 0, 102, 0.85);
      border-radius: 12px;
      padding: 22px;
      box-shadow: 0 0 14px rgba(0,0,0,0.35);
    }
    h1 {
      text-align: center;
      color: #ffd700;
      margin: 0 0 10px 0;
    }
    #username {
      text-align: center;
      font-size: 18px;
      margin-bottom: 16px;
      color: #ffd700;
    }
    #question {
      font-size: 18px;
      margin-bottom: 16px;
      text-align: center;
      line-height: 1.35;
      min-height: 46px;
    }
    #options {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
    }
    button {
      padding: 10px;
      font-size: 16px;
      cursor: pointer;
      background-color: #000099;
      color: white;
      border: 2px solid #ffd700;
      border-radius: 6px;
      transition: background-color 0.25s, transform 0.05s;
    }
    button:hover { background-color: #0000cc; }
    button:active { transform: scale(0.98); }
    #result, #friend-advice {
      margin-top: 16px;
      font-weight: bold;
      text-align: center;
      min-height: 20px;
    }
    #score, #level, #lifelines {
      margin-top: 10px;
      text-align: center;
    }
    #lifelines button { margin: 5px; }
  </style>
</head>
<body>
  <div id="game-container">
    <h1>¿Quién quiere ser millonario? - Scrum & Green Project Management</h1>
    <div id="username"></div>

    <div id="question"></div>
    <div id="options"></div>
    <div id="result"></div>
    <div id="friend-advice"></div>

    <div id="score">Premio: $<span id="score-value">0</span></div>
    <div id="level">Nivel: <span id="level-value">1</span></div>

    <div id="lifelines">
      <button id="fifty-fifty">50:50</button>
      <button id="ask-friend">Preguntar a un amigo</button>
    </div>
  </div>

  <script type="module">
    // ===== Firebase (v11 modular) =====
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-analytics.js";
    import {
      getFirestore,
      collection,
      addDoc
    } from "https://www.gstatic.com/firebasejs/11.5.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBk038Zx83YW4ciSfkJA7COa3inBC_tATY",
      authDomain: "incomers-bee7d.firebaseapp.com",
      projectId: "incomers-bee7d",
      storageBucket: "incomers-bee7d.firebasestorage.app",
      messagingSenderId: "821388332213",
      appId: "1:821388332213:web:0170ab2584f136fa5682fc",
      measurementId: "G-88PT3PBF1N"
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getFirestore(app);

    // ===== Juego =====
    let username = prompt("Por favor, ingresa tu nombre:");
    if (!username || !username.trim()) {
      username = "Anónimo";
    }
    document.getElementById("username").textContent = `Jugador: ${username}`;

    // Banco de preguntas (4 tuyas + 6 nuevas)
    const questions = [
      {
        question: "1. ¿Cuáles son los tres pilares fundamentales en los que se basa Scrum?",
        options: [
          "Transparencia, Inspección, Adaptación",
          "Planificación, Ejecución y Cierre.",
          "Jerarquía, Control y Documentación.",
          "Velocidad, Eficiencia y Flexibilidad."
        ],
        correct: 0,
        value: 100
      },
      {
        question: "2. ¿Cuál es la diferencia entre la \"Triple Línea Base\" tradicional y el enfoque expandido del Estándar P5?",
        options: [
          "La Triple Línea Base se enfoca en personas, planeta y prosperidad, mientras que el P5 expande esto añadiendo producto y proceso, ofreciendo una visión más holística.",
          "La Triple Línea Base se enfoca en el corto plazo, mientras que el P5 se enfoca en el largo plazo.",
          "La Triple Línea Base es para proyectos pequeños, y el P5 es para proyectos grandes.",
          "La Triple Línea Base es un concepto obsoleto, y el P5 es su reemplazo directo sin ninguna relación."
        ],
        correct: 0,
        value: 100
      },
      {
        question: "3. ¿Cuál de las siguientes opciones describe mejor una característica clave de Scrum?",
        options: [
          "Se basa en planes rígidos definidos desde el inicio del proyecto.",
          "Promueve un trabajo iterativo e incremental con adaptación al cambio.",
          "Depende de un solo líder que toma todas las decisiones.",
          "Prioriza la documentación extensa sobre la entrega de valor."
        ],
        correct: 1,
        value: 100
      },
      {
        question: "4. ¿Cuál de los siguientes principios de Scrum se enfoca en que el equipo sea responsable de realizar su propio trabajo sin depender de una autoridad externa?",
        options: [
          "Priorización por valor",
          "Autoorganización",
          "Timeboxing",
          "Control empírico"
        ],
        correct: 1,
        value: 100
      },
      {
        question: "5. ¿Qué rol en Scrum es responsable de maximizar el valor del producto?",
        options: [
          "Product Owner",
          "Scrum Master",
          "Developers",
          "Patrocinador/Stakeholders"
        ],
        correct: 0,
        value: 100
      },
      {
        question: "6. ¿Cuál es la duración del Daily Scrum?",
        options: [
          "15 minutos",
          "30 minutos",
          "45 minutos",
          "1 hora"
        ],
        correct: 0,
        value: 100
      },
      {
        question: "7. ¿Cuál de los siguientes artefactos representa el resultado utilizable tras un Sprint?",
        options: [
          "Product Backlog",
          "Sprint Backlog",
          "Incremento",
          "Roadmap del producto"
        ],
        correct: 2,
        value: 100
      },
      {
        question: "8. ¿Cuál es la duración típica de un Sprint según Scrum?",
        options: [
          "1 a 4 semanas",
          "1 a 2 meses",
          "1 a 2 días",
          "6 a 8 semanas"
        ],
        correct: 0,
        value: 100
      },
      {
        question: "9. Según Green Project Management, ¿cuál de estas prácticas ayuda a reducir el impacto ambiental del proyecto?",
        options: [
          "Reuniones virtuales para disminuir traslados",
          "Imprimir toda la documentación para control",
          "Aumentar el número de entregas sin medir impacto",
          "Duplicar las pruebas físicas por seguridad"
        ],
        correct: 0,
        value: 100
      },
      {
        question: "10. ¿Cuál de las siguientes es una fase de la metodología PRiSM?",
        options: [
          "Descubrimiento",
          "Financiación",
          "Operación continua",
          "Auditoría externa"
        ],
        correct: 0,
        value: 100
      }
    ];

    let currentQuestion = 0;
    let score = 0;
    let fiftyFiftyUsed = false;
    let askFriendUsed = false;
    let startTime;
    let endTime;

    function loadQuestion() {
      if (currentQuestion === 0) {
        startTime = new Date(); // iniciar temporizador
      }
      const questionEl = document.getElementById("question");
      const optionsEl = document.getElementById("options");
      const resultEl = document.getElementById("result");
      const friendAdviceEl = document.getElementById("friend-advice");

      questionEl.textContent = questions[currentQuestion].question;
      optionsEl.innerHTML = "";
      resultEl.textContent = "";
      friendAdviceEl.textContent = "";

      questions[currentQuestion].options.forEach((option, index) => {
        const button = document.createElement("button");
        button.textContent = option;
        button.onclick = () => checkAnswer(index);
        optionsEl.appendChild(button);
      });

      updateLifelinesVisibility();
      document.getElementById("level-value").textContent = currentQuestion + 1;
    }

    function checkAnswer(userAnswer) {
      const resultEl = document.getElementById("result");
      const scoreEl = document.getElementById("score-value");

      if (userAnswer === questions[currentQuestion].correct) {
        resultEl.textContent = "¡Correcto!";
        score += questions[currentQuestion].value;
        scoreEl.textContent = score;
        currentQuestion++;
        if (currentQuestion < questions.length) {
          setTimeout(loadQuestion, 1200);
        } else {
          endTime = new Date();
          const timeTaken = (endTime - startTime) / 1000; // en segundos
          saveScore(username, score, timeTaken);
          alert(`¡Felicidades, ${username}! Has ganado $${score}. Tiempo: ${timeTaken} s.`);
          // Si deseas también reiniciar al ganar, descomenta:
          // restartGame();
        }
      } else {
        endTime = new Date();
        const timeTaken = (endTime - startTime) / 1000;
        resultEl.textContent = "Incorrecto. Juego terminado.";
        saveScore(username, score, timeTaken);
        alert(`Juego terminado. Premio final: $${score}. Tiempo: ${timeTaken} s.`);

        // Reiniciar y volver al inicio al equivocarse
        restartGame();
      }
    }

    function fiftyFifty() {
      if (fiftyFiftyUsed) return;
      fiftyFiftyUsed = true;
      const optionsEl = document.getElementById("options").children;
      let removed = 0;
      for (let i = 0; i < optionsEl.length; i++) {
        if (i !== questions[currentQuestion].correct && removed < 2) {
          optionsEl[i].style.display = "none";
          removed++;
        }
      }
      updateLifelinesVisibility();
    }

    function askFriend() {
      if (askFriendUsed) return;
      askFriendUsed = true;
      document.getElementById("friend-advice").textContent =
        `Tu amigo sugiere que la respuesta es: ${questions[currentQuestion].options[questions[currentQuestion].correct]}.`;
      updateLifelinesVisibility();
    }

    function updateLifelinesVisibility() {
      document.getElementById("fifty-fifty").style.display = fiftyFiftyUsed ? "none" : "inline-block";
      document.getElementById("ask-friend").style.display = askFriendUsed ? "none" : "inline-block";
    }

    // Reiniciar juego (volver al inicio)
    function restartGame() {
      currentQuestion = 0;
      score = 0;
      fiftyFiftyUsed = false;
      askFriendUsed = false;

      document.getElementById("score-value").textContent = score;
      document.getElementById("friend-advice").textContent = "";
      document.getElementById("result").textContent = "";

      updateLifelinesVisibility();
      setTimeout(loadQuestion, 600); // pequeña pausa antes de volver a empezar
    }

    document.getElementById("fifty-fifty").onclick = fiftyFifty;
    document.getElementById("ask-friend").onclick = askFriend;
    loadQuestion();

    // ===== Persistencia de puntuaciones (fecha y hora) =====
    async function saveScore(name, score, timeTaken) {
      const now = new Date();
      const fechaHoraISO = now.toISOString(); // ideal para ordenamiento/consultas
      const fechaHoraLocal = now.toLocaleString('es-CO', {
        year: 'numeric', month: 'numeric', day: 'numeric',
        hour: '2-digit', minute: '2-digit', second: '2-digit',
        timeZoneName: 'short'
      });

      try {
        await addDoc(collection(db, "scores"), {
          nombre: name,
          puntuacion: score,
          tiempo: timeTaken,   // en segundos
          fechaHoraISO,        // 2026-02-10T18:40:22.345Z
          fechaHoraLocal       // 10/2/2026, 13:40:22 GMT-5
        });
        // Ya no se muestra la lista dentro del juego
      } catch (e) {
        console.error("Error al agregar el documento: ", e);
        alert("Hubo un error al guardar la información.");
      }
    }
  </script>
</body>
</html>
